#Generated by Kickstart Configurator
#platform=x86

#System language
lang it_IT
#Language modules to install
langsupport it_IT
#System keyboard
keyboard it
#System mouse
mouse
#System timezone
timezone --utc Europe/Rome
#Root password
rootpw --disabled
#Initial user
user amministratore --fullname "amministratore" --iscrypted --password $1$TFuwQmr.$mNnX2ytJGGpw96mln4wMg0
#Reboot after installation
reboot
#Use text mode install
text
#Install OS instead of upgrade
install
#Use Web installation
url --url http://{{salt['grains.get']('localhost', 'ERROR')}}/ubuntu
#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel 
#Disk partitioning information
part swap --recommended --asprimary 
part / --fstype ext4 --size 1 --grow --asprimary 
#System authorization infomation
auth  --useshadow  --enablemd5 
#Network information
network --bootproto=dhcp --device=eth0
#Firewall configuration
firewall --disabled 
#Do not configure the X Window System
skipx
#Services
services --enabled=openssh,salt-minion

#Package selection
%packages
openssh-server
salt-minion
vim

#Post installation commands
%post --nochroot
echo "master: {{salt['grains.get']('localhost', 'ERROR')}}" >> /target/etc/salt/minion
echo "state_events: True" >> /target/etc/salt/minion
wget http://{{salt['grains.get']('localhost', 'ERROR')}}:3000/mac2hostname\?mac\=`ip link | grep ether | sed -e "s/^ *//" | cut -d " " -f 2 | sed -e "s/:/_/g"` -O /target/etc/hostname
